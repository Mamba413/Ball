<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests • Ball</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests">
<meta property="og:description" content="Ball">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Ball</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Ball.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bd_gwas.html">`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Mamba413/Ball/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bd_gwas_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>
<code>bd.gwas.test</code>: Fast Ball Divergence Test for Multiple Hypothesis Tests</h1>
                        <h4 class="author">Yue Hu, Jin Zhu</h4>
            
            <h4 class="date">2021/8/15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Mamba413/Ball/tree/master/R-package/../vignettes/bd_gwas.Rmd"><code>../vignettes/bd_gwas.Rmd</code></a></small>
      <div class="hidden name"><code>bd_gwas.Rmd</code></div>

    </div>

    
    
<div id="description" class="section level2">
<h2 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h2>
<p>The K-sample Ball Divergence is a nonparametric method to test the differences between K probability distributions. It is specially designed for multivariate and imbalanced data, which is consistent with the characteristics of the GWAS data. It is computationally intensive for a large GWAS dataset because of the ultrahigh dimensionality of the data. Therefore, fast K-sample Ball Divergence Test for GWAS data is developed to accelerate the computational speed. It uses a two-step algorithm for KBD. The algorithm first computes an empirical p-value for each SNP using a modest number of permutations which gives precise enough estimates of the p-values above a threshold. Then, the SNPs with first stage p-values being less than the threshold are moved to the second stage for a far greater number of permutations.</p>
</div>
<div id="faster-implementation-for-multiple-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#faster-implementation-for-multiple-testing" class="anchor"></a>Faster implementation for multiple testing</h2>
<p>We implement <code>bd.test.gwas</code> in Ball package for handling multiple <span class="math inline">\(K\)</span>-sample test. The key technique in <code>bd.test.gwas</code> is reusing the empirical KBD’s distribution under the null hypothesis. This technique is particularly helpful for decreasing computational burden when the number of factors <span class="math inline">\(p\)</span> is very large and <span class="math inline">\(K\)</span> is a single digit. A typical case is the GWAS study, in which <span class="math inline">\(p \approx 10^4\)</span> or <span class="math inline">\(10^5\)</span> but <span class="math inline">\(K = 3\)</span>.</p>
</div>
<div id="details" class="section level2">
<h2 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h2>
<p>According to the simulations, the empirical type I errors of KBD are reasonably controlled around <span class="math inline">\(10^-5\)</span> and the power of KBD increases as either the sample size or the difference between means or covariance matrices increases. The empirical power is close to 1 when the difference between distributions is large enough.</p>
<p>Furthermore, correlated responses may slightly decrease the power of the test compared to the case of independent responses. Moreover, KBD performs better when the data are not extremely imbalanced and it maintains reasonable power for the imbalanced setting.</p>
<p>Overall, KBD is a powerful method that can detect the significant variants with a controllable type I error regardless if the data are balanced or not. There is an inverse relationship between minor allele frequency and the desired sample sizes to obtain enough power.</p>
<p>Compared to other methods, KBD performs better in most of the scenarios, especially when the simulation setting is close to the real data. Moreover, KBD is more computationally efficient in identifying significant variants.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<div id="example-1" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1:</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CVTuningCov</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mamba413.github.io/ball">Ball</a></span><span class="op">)</span>

<span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">snp_num</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">k</span><span class="op">&lt;-</span><span class="fl">100</span>
<span class="va">rho</span><span class="op">&lt;-</span><span class="fl">0.5</span>
<span class="va">freq0</span><span class="op">&lt;-</span><span class="fl">0.75</span>
<span class="va">d</span><span class="op">&lt;-</span><span class="fl">2</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>

<span class="va">mean0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">k</span><span class="op">)</span>
<span class="va">mean1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">*</span><span class="va">d</span>,<span class="va">k</span><span class="op">)</span>
<span class="va">mean2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span><span class="op">*</span><span class="va">d</span>,<span class="va">k</span><span class="op">)</span>

<span class="va">cov0</span><span class="op">&lt;-</span><span class="fu">AR1</span><span class="op">(</span>p<span class="op">=</span><span class="va">k</span>,rho<span class="op">=</span><span class="va">rho</span><span class="op">)</span>
<span class="va">cov1</span><span class="op">&lt;-</span><span class="fu">AR1</span><span class="op">(</span>p<span class="op">=</span><span class="va">k</span>,rho<span class="op">=</span><span class="va">rho</span><span class="op">-</span><span class="fl">0.1</span><span class="op">*</span><span class="va">d</span><span class="op">)</span>
<span class="va">cov2</span><span class="op">&lt;-</span><span class="fu">AR1</span><span class="op">(</span>p<span class="op">=</span><span class="va">k</span>,rho<span class="op">=</span><span class="va">rho</span><span class="op">+</span><span class="fl">0.1</span><span class="op">*</span><span class="va">d</span><span class="op">)</span>

<span class="va">x0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,mu<span class="op">=</span><span class="va">mean0</span>,Sigma <span class="op">=</span> <span class="va">cov0</span><span class="op">)</span>
<span class="va">x1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">)</span>,mu<span class="op">=</span><span class="va">mean1</span>,Sigma <span class="op">=</span> <span class="va">cov1</span><span class="op">)</span>
<span class="va">x2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">num</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">)</span>,mu<span class="op">=</span><span class="va">mean2</span>,Sigma <span class="op">=</span> <span class="va">cov2</span><span class="op">)</span>
<span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">x0</span>,<span class="va">x1</span>,<span class="va">x2</span><span class="op">)</span>

<span class="va">snp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
         <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="va">num</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">num</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">snp</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="va">snp_num</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">num</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, 
               prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span>, <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bd.gwas.test.html">bd.gwas.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, snp <span class="op">=</span> <span class="va">snp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">p.value</span><span class="op">&lt;</span><span class="fl">5</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-2" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2:</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span><span class="op">&lt;-</span><span class="fl">0</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>

<span class="va">mean</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">k</span><span class="op">)</span>

<span class="va">cov</span><span class="op">&lt;-</span><span class="fu">AR1</span><span class="op">(</span>p<span class="op">=</span><span class="va">k</span>,rho<span class="op">=</span><span class="va">rho</span><span class="op">)</span>

<span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html">mvrnorm</a></span><span class="op">(</span><span class="va">num</span>,mu<span class="op">=</span><span class="va">mean</span>,Sigma <span class="op">=</span> <span class="va">cov</span><span class="op">)</span>

<span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">snp_num</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, size <span class="op">=</span> <span class="va">num</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, 
               prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">freq0</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">*</span><span class="va">freq0</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span>, <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">freq0</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bd.gwas.test.html">bd.gwas.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, snp <span class="op">=</span> <span class="va">snp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">p.value</span><span class="op">&lt;</span><span class="fl">5</span><span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jin Zhu, Wenliang Pan, Yuan Tian, Weinan Xiao, Chengfeng Liu, Ruihuang Liu, Yue Hu, Hongtu Zhu, Heping Zhang, Xueqin Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
