#include <stdlib.h>
#include <stdio.h>
#include "BD.h"

void test_value(double computed_value, double true_value)
{
	const double EPSINON = 0.00001;
	double difference = computed_value - true_value;
	if ((difference < EPSINON) & (difference > -EPSINON)) {
		printf("Success!\n\n");
	}
	else {
		printf("Fail!\n\n");
	}
	return;
}


void bd_test_2sample_multithread_permutation()
{
	double ball_stat_value[2], p_value[2];
	double x[500] = { 2.25175, 1.55615, 0.54524, 2.85418, 1.10683, 0.72145, 1.97587, 0.84344, -1.70603, -0.78955, 2.32068, 0.97631, 0.77115, 1.82555, -0.40834, 0.70672, 1.35385, 1.65415, 0.54051, 1.76525, 0.64433, 1.7401, 0.16161, 1.713, 1.08914, 0.39928, 1.47068, 1.04822, 0.74917, 0.2367, 1.22338, 1.93922, -0.84661, 0.0847, 2.92419, 0.57285, 0.84396, -1.94022, 0.14856, 1.23254, 1.07918, 1.79337, 2.72291, 0.63817, 1.01389, 0.95096, 1.5309, 1.28475, 0.56053, 0.50629, 0.18289, 1.03813, 1.24354, 1.53103, 0.14486, 0.97716, 0.91053, 0.52578, 0.72429, 0.43408, 1.67109, 1.27183, 1.69888, 0.76495, 0.67365, 0.35637, 0.01117, 1.18014, -0.3262, 0.64187, -0.02459, 0.31699, 2.20765, -0.61115, 0.16935, 0.96341, -0.0671, 1.43816, 0.43653, 2.5803, 1.36074, 0.10524, -0.4532, 0.908, 1.71979, 2.05462, 0.28815, 0.63903, 0.75906, 2.10066, 1.64896, 2.14244, 1.01404, 2.49235, 2.23282, 1.34103, 0.66155, 2.235, -0.35812, 1.51349, 0.90529, 1.14303, 0.36791, 1.37934, -1.43776, 1.07899, 0.80347, 2.65376, 1.75877, 1.57104, 0.31, 2.09237, 0.38631, 1.6475, 1.99678, 0.81316, 0.57989, -0.02215, 0.99435, 0.40954, 2.20811, 1.479, 1.49441, 0.0701, 0.87551, 0.39109, 1.29121, 0.54331, 1.66132, 1.1505, 3.23168, 1.58024, 2.08576, 2.66405, 1.79259, -0.953, 1.70187, -0.11666, 0.59768, -0.06712, 1.8215, 0.48039, -0.75134, 0.13491, 1.53026, 0.38776, 0.54211, 2.80549, 2.10628, 1.96142, 1.22193, 3.45196, 0.52233, 1.14369, 2.39459, 0.12202, -0.04252, 1.64233, 1.86858, 1.62409, 1.74682, -1.05572, 1.42309, 0.70916, -0.75358, 0.99209, -0.88119, -0.0581, -0.76142, 1.67469, 1.88033, 1.38972, 1.00137, 1.3897, 1.98954, 2.12393, 0.49024, 1.65855, 0.49964, 1.92137, 2.68253, 1.55927, -0.07893, 0.5343, -0.91064, 1.17404, 2.10121, 0.43845, 0.73953, 0.66175, 1.7428, 0.53864, 1.02051, 2.66725, 0.92197, 0.22764, -0.25545, -0.17605, -0.4281, -0.24533, 0.62213, 0.91474, -0.58603, 0.36518, 1.19489, 0.18535, 0.08253, 0.77608, 2.37213, 0.58334, 0.3253, 1.99076, 0.49968, 1.79846, -0.45763, 1.63836, 1.30264, 1.92182, 2.48508, 1.13147, -0.19058, 0.88212, -1.01598, 0.77181, -0.31026, 0.62621, 0.16373, 0.2404, 1.06689, -0.71961, 0.45225, 2.05092, 1.7834, 0.76702, -0.41365, 0.98748, -1.33853, 0.24561, 0.06651, -0.27744, -0.76812, -0.41024, -0.38618, 0.32252, 1.63112, -0.06034, 0.25776, -1.54519, 0.24131, 1.54197, 0.51826, 1.97117, 1.91757, -0.67011, 0.41305, -0.05486, -0.35572, 2.02861, 0.23772, 1.64604, -0.29029, -0.18933, 1.12945, -0.29203, -0.12381, 0.38669, -0.48716, 0.18902, 1.0314, -0.64156, -0.99785, -0.95451, -1.00394, -1.07203, 0.79471, 3.1304, 0.87868, 0.62735, -0.00596, 0.56395, -0.16823, 0.581, 0.6356, 0.94813, -0.92096, 1.66221, 0.16091, 0.48368, -0.16963, 0.30523, -1.48444, -1.43197, 0.00041, -0.96845, 0.22431, 0.42396, -1.2707, 0.30458, 2.58439, 1.01013, 0.02986, -0.16052, 0.73194, -0.83472, 0.03374, -0.4647, -0.49565, 0.73078, 1.3263, -1.43352, 1.14522, 0.87447, 0.59477, -2.91983, 0.9821, 0.04228, -0.7579, 0.72066, 0.63426, -1.98498, -1.84243, 0.23127, 1.36689, 0.65751, -1.32793, 0.76658, 0.91408, -0.36984, 0.24676, -1.32251, 1.11424, 0.28732, -1.71797, 0.68414, 0.35187, -0.38769, 0.23127, -1.53572, 1.3105, 0.84261, 0.84039, -0.39682, -0.59393, -0.4193, 0.78651, -1.87045, -0.05073, 1.12713, -1.13818, 0.41322, -0.85635, 0.85415, 0.09091, -1.02064, -0.86351, 0.97995, -0.44872, 1.56491, 1.01164, -0.31884, 0.50394, 1.38312, -0.29272, 1.17322, 1.4049, -0.33293, 2.18284, -0.1389, 1.5242, 1.25374, -0.55504, -1.91363, 0.45471, -1.07961, -0.69629, -1.45287, -0.48276, -0.29733, -0.1064, 1.7312, 0.64748, -1.12057, 0.6634, -0.48684, -0.43941, 0.40728, -0.07195, 0.61082, 0.68196, -2.13277, 0.30082, -0.58186, 0.29594, -0.93074, 0.95474, -0.80438, 2.12899, 0.48902, 0.81091, 0.4143, -0.12889, 1.50433, 1.88676, 0.89654, 1.01675, 0.00424, 1.42727, -0.72508, 1.05808, -0.02322, 0.87603, 1.03567, 0.21079, -0.09184, -0.90076, -0.4944, -1.22989, 0.78523, -0.14292, 0.1735, -0.87049, 1.01657, -0.07105, -0.77789, -1.67587, -0.4794, -0.50866, 1.81928, -0.78227, 0.93179, 1.11011, 0.53856, 1.00276, -1.01718, -0.72113, -1.22834, 0.16478, -1.49958, -0.01627, 0.61458, 0.30104, -0.15816, -1.32077, -2.45525, 0.43569, 0.37217, -0.9515, 0.30982, -1.27753, 0.48857, -0.33971, 0.01417, -1.51227, -1.08933, 1.11125, 1.00337, -0.55228, -2.49924, -0.56945, 1.857, -0.76726, -0.5512, 0.33967, 0.45384, -0.42878, 0.70092, 0.84725, -0.08575, 0.96277, -0.88731, -0.05063, 0.56627, -0.18277, 0.00336, 0.60146, -1.4978, 0.99308, -0.59198, 0.00807, 0.33094, 0.67669, -1.58132, -0.05644, 0.9292, -0.94089, -0.62233, -0.14153, -1.2477, -0.13975, -1.28383, 0.59095, 0.42241, -1.60643, 0.10822, -0.50155, -0.3301, 1.86959, 0.30328, -0.15598, -2.63078 };
	int size[2] = { 250, 250 };
	int k = 2;
	int n = 500;
	int dst = 0, R = 199, nth = 2;
	int parallel_type = 2;
	bd_test(ball_stat_value, p_value, x, size, &n, &k, &dst, &R, &nth);
	printf("Ball statistics: %f; ", ball_stat_value[0]);
	printf("p-value: %f \n", p_value[0]);
	printf("Ball statistics: %f; ", ball_stat_value[1]);
	printf("p-value: %f \n", p_value[1]);
	test_value(ball_stat_value[0], 0.059821);
	return;
}

void bd_test_ksample_multithread_permutation()
{
	double ball_stat_value[4], p_value[4];
	double x[15] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 };
	int size[3] = { 5, 5, 5};
	int k = 3;
	int n = 15;
	int dst = 0, R = 199, nth = 2;
	int parallel_type = 2;
	bd_test(ball_stat_value, p_value, x, size, &n, &k, &dst, &R, &nth);
	printf("Ball statistics: %f; ", ball_stat_value[0]);
	printf("p-value: %f \n", p_value[0]);
	printf("Ball statistics: %f; ", ball_stat_value[1]);
	printf("p-value: %f \n", p_value[1]);
	printf("Ball statistics: %f; ", ball_stat_value[2]);
	printf("p-value: %f \n", p_value[2]);
	printf("Ball statistics: %f; ", ball_stat_value[3]);
	printf("p-value: %f \n", p_value[3]);
	return;
}


void main()
{
	bd_test_2sample_multithread_permutation();
	bd_test_ksample_multithread_permutation();
	system("pause");
	return;
}