<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests ‚Ä¢ Ball</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Ball</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.14</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/Ball.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bd_gwas.html">`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Mamba413/Ball/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`bd.gwas.test`: Fast Ball Divergence Test for Multiple Hypothesis Tests</h1>
                        <h4 data-toc-skip class="author">Yue Hu, Jin
Zhu</h4>
            
            <h4 data-toc-skip class="date">2021/8/25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Mamba413/Ball/tree/master/R-package/vignettes/bd_gwas.Rmd" class="external-link"><code>vignettes/bd_gwas.Rmd</code></a></small>
      <div class="d-none name"><code>bd_gwas.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>-sample
Ball Divergence (KBD) is a nonparametric method to test the differences
between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
probability distributions. It is specially designed for metric-valued
and imbalanced data, which is consistent with the characteristics of the
GWAS data. It is computationally intensive for a large GWAS dataset
because of the ultra-high dimensionality of the data. Therefore, a fast
KBD Test for GWAS data implemented in function <code>bd.gwas.test</code>
is developed and programmed to accelerate the computational speed.</p>
</div>
<div class="section level2">
<h2 id="faster-implementation-quick-start">Faster implementation: quick start<a class="anchor" aria-label="anchor" href="#faster-implementation-quick-start"></a>
</h2>
<p>We use a synthetic data to demonstrate the usage of
<code>bd.gwas.test</code>. In this example, phenotype data are generated
from three multivariate normal distributions with the same dimension but
heterogeneous mean and covariance matrix. The three multivariate normal
distributions are: (i).
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>‚àº</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>,</mo><msup><mi>Œ£</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N\sim(\mu, \Sigma^{(1)})</annotation></semantics></math>,
(ii)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>‚àº</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>+</mo><mn>0.1</mn><mo>√ó</mo><mi>d</mi><mo>,</mo><msup><mi>Œ£</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N \sim (\mu + 0.1 \times d, \Sigma^{(2)})</annotation></semantics></math>,
and (iii)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>‚àº</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œº</mi><mo>+</mo><mn>0.1</mn><mo>√ó</mo><mi>d</mi><mo>,</mo><msup><mi>Œ£</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N \sim (\mu + 0.1 \times d, \Sigma^{(3)})</annotation></semantics></math>.
Here, the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œº</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is set to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">ùüé</mtext><annotation encoding="application/x-tex">\textbf{0}</annotation></semantics></math>
and the covariance matrix covariance matrices follow the auto-regressive
structure with some perturbations:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œ£</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><msup><mi>œÅ</mi><mrow><mo stretchy="true" form="prefix">|</mo><mi>i</mi><mo>‚àí</mo><mi>j</mi><mo stretchy="true" form="postfix">|</mo></mrow></msup><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><msubsup><mi>Œ£</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÅ</mi><mo>‚àí</mo><mn>0.1</mn><mo>√ó</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>i</mi><mo>‚àí</mo><mi>j</mi><mo stretchy="true" form="postfix">|</mo></mrow></msup><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><msubsup><mi>Œ£</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>3</mn></msubsup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÅ</mi><mo>+</mo><mn>0.1</mn><mo>√ó</mo><mi>d</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">|</mo><mi>i</mi><mo>‚àí</mo><mi>j</mi><mo stretchy="true" form="postfix">|</mo></mrow></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">\Sigma_{ij}^{(1)}=\rho^{|i-j|}, ~~ \Sigma^{(2)}_{ij}=(\rho-0.1 \times d)^{|i-j|}, ~~ \Sigma^{3}_{ij}=(\rho+0.1 \times d)^{|i-j|}.</annotation></semantics></math>
The dimension of phenotype
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
is fixed as 100.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">snp_num</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">freq0</span> <span class="op">&lt;-</span> <span class="fl">0.75</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ar1</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">p</span>, <span class="va">rho</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> </span>
<span><span class="op">{</span></span>
<span>    <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span>, <span class="va">p</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">Sigma</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rho</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="va">j</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mean0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span><span class="op">)</span></span>
<span><span class="va">mean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">d</span>, <span class="va">k</span><span class="op">)</span></span>
<span><span class="va">mean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">d</span>, <span class="va">k</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cov0</span> <span class="op">&lt;-</span> <span class="fu">ar1</span><span class="op">(</span>p <span class="op">=</span> <span class="va">k</span>, rho <span class="op">=</span> <span class="va">rho</span><span class="op">)</span></span>
<span><span class="va">cov1</span> <span class="op">&lt;-</span> <span class="fu">ar1</span><span class="op">(</span>p <span class="op">=</span> <span class="va">k</span>, rho <span class="op">=</span> <span class="va">rho</span> <span class="op">-</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">cov2</span> <span class="op">&lt;-</span> <span class="fu">ar1</span><span class="op">(</span>p <span class="op">=</span> <span class="va">k</span>, rho <span class="op">=</span> <span class="va">rho</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">freq0</span> <span class="op">^</span> <span class="fl">2</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">freq0</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">freq0</span><span class="op">)</span></span>
<span><span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">num</span> <span class="op">*</span> <span class="va">p1</span><span class="op">)</span></span>
<span><span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">num</span> <span class="op">*</span> <span class="va">p2</span><span class="op">)</span></span>
<span><span class="va">n3</span> <span class="op">&lt;-</span> <span class="va">num</span> <span class="op">-</span> <span class="va">n1</span> <span class="op">-</span> <span class="va">n2</span></span>
<span><span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n1</span>, mean <span class="op">=</span> <span class="va">mean0</span>, sigma <span class="op">=</span> <span class="va">cov0</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n2</span>, mean <span class="op">=</span> <span class="va">mean1</span>, sigma <span class="op">=</span> <span class="va">cov1</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n3</span>, mean <span class="op">=</span> <span class="va">mean2</span>, sigma <span class="op">=</span> <span class="va">cov2</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             [,1]       [,2]       [,3]       [,4]       [,5]       [,6]</span></span>
<span><span class="co">## [1,]  0.07039579  0.6100092  0.5546911  0.5346480  0.5785020 -1.3470882</span></span>
<span><span class="co">## [2,] -0.19620313  0.2196482 -0.2968494 -0.7916355 -1.3371275 -0.5766259</span></span>
<span><span class="co">## [3,] -0.18575434 -1.4601779 -1.2635876 -0.8933793 -0.9336481 -0.5277624</span></span>
<span><span class="co">## [4,]  1.56843201  1.6330457  1.8725853  0.8344465  0.5674250 -0.3928510</span></span>
<span><span class="co">## [5,] -0.54939765  0.1602176  0.4325440 -0.1750343  0.5231533 -1.0931093</span></span>
<span><span class="co">## [6,] -0.19665796 -1.3788672 -0.6887342 -1.2731113 -0.6638883  0.0764279</span></span></code></pre>
<p>The number of SNPs is fixed as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>200</mn><annotation encoding="application/x-tex">200</annotation></semantics></math>
and the sample size is set to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>100</mn><annotation encoding="application/x-tex">100</annotation></semantics></math>.
The sample sizes of the three groups follow the transmission ratio:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>:</mo><msub><mi>n</mi><mn>2</mn></msub><mo>:</mo><msub><mi>n</mi><mn>3</mn></msub><mo>‚âà</mo><msup><mi>p</mi><mn>2</mn></msup><mo>:</mo><mn>2</mn><mi>p</mi><mi>q</mi><mo>:</mo><msup><mi>q</mi><mn>2</mn></msup><mo>,</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo>+</mo><mi>q</mi><mo>=</mo><mn>1</mn><mo>,</mo><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub><mo>+</mo><msub><mi>n</mi><mn>3</mn></msub><mo>=</mo><mn>100</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">n_1:n_2:n_3 \approx p^2:2pq:q^2,(p+q=1,n_1+n_2+n_3=100).</annotation></semantics></math>
Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is set to be
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.75</mn><annotation encoding="application/x-tex">0.75</annotation></semantics></math>,
representing a scenario that close to the real data.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
is a user-specific positive integer, indicating the differences between
the three probability distributions. Here, we use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">d=3</annotation></semantics></math>,
aiming to show that the SNP which matched with the distribution can be
identified, even when the differences between distribution is small.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">effect_snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n2</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">n3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">noise_snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="va">snp_num</span>, <span class="kw">function</span><span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>    <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>    size <span class="op">=</span> <span class="va">num</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">p1</span> <span class="op">-</span> <span class="va">p2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">snp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">effect_snp</span>, <span class="va">noise_snp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">snp</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      effect_snp          </span></span>
<span><span class="co">## [1,]          0 1 0 0 0 0</span></span>
<span><span class="co">## [2,]          0 1 1 1 0 0</span></span>
<span><span class="co">## [3,]          0 0 0 1 0 0</span></span>
<span><span class="co">## [4,]          0 0 1 0 2 0</span></span>
<span><span class="co">## [5,]          0 1 1 0 0 0</span></span>
<span><span class="co">## [6,]          0 1 1 1 1 0</span></span></code></pre>
<p>Given the synthetic dataset <code>x</code> and <code>snp</code>,
multiple KBD tests is conducted by:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mamba413.github.io/Ball/">Ball</a></span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bd.gwas.test.html">bd.gwas.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, snp <span class="op">=</span> <span class="va">snp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## =========== Pre-screening SNPs ===========</span></span>
<span><span class="co">## Refining SNP... Progress: 1/1. </span></span>
<span><span class="co">## Refined p-value: 0.0000499975, cost time: 2 (s).</span></span></code></pre>
<p>And we present the SNPs that is significant:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ statistic                 : num [1:200] 4.218 0.876 1.881 1.104 1.143 ...</span></span>
<span><span class="co">##  $ permuted.statistic        :'data.frame':  20000 obs. of  1 variable:</span></span>
<span><span class="co">##   ..$ g3: num [1:20000] 0.819 1.114 1.112 1.563 0.906 ...</span></span>
<span><span class="co">##  $ eigenvalue                : NULL</span></span>
<span><span class="co">##  $ p.value                   : num [1:200] 0.00005 0.9112 0.0577 0.60847 0.55267 ...</span></span>
<span><span class="co">##  $ refined.snp               : int 1</span></span>
<span><span class="co">##  $ refined.p.value           : num 5e-05</span></span>
<span><span class="co">##  $ refined.permuted.statistic: num [1:20000, 1] 1.216 0.857 0.988 0.937 1.37 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : NULL</span></span>
<span><span class="co">##   .. ..$ : chr "SNP1"</span></span>
<span><span class="co">##  $ screening.result          :List of 5</span></span>
<span><span class="co">##   ..$ : num [1:200] 4.218 0.876 1.881 1.104 1.143 ...</span></span>
<span><span class="co">##   ..$ :'data.frame': 20000 obs. of  1 variable:</span></span>
<span><span class="co">##   .. ..$ g3: num [1:20000] 0.819 1.114 1.112 1.563 0.906 ...</span></span>
<span><span class="co">##   ..$ : num [1:200] 0.00005 0.9112 0.0577 0.60847 0.55267 ...</span></span>
<span><span class="co">##   ..$ : int [1:10000] 0 97 44 35 95 99 39 19 46 65 ...</span></span>
<span><span class="co">##   ..$ : int 0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="why-bd-gwas-test-is-faster">Why <code>bd.gwas.test</code> is faster?<a class="anchor" aria-label="anchor" href="#why-bd-gwas-test-is-faster"></a>
</h2>
<p>Our faster implementation for multiple testing significantly speeds
up the KBD test in two aspects.</p>
<div class="section level3">
<h3 id="two-step-algorithm">Two-step algorithm<a class="anchor" aria-label="anchor" href="#two-step-algorithm"></a>
</h3>
<p>First, it uses a two-step algorithm for KBD. The algorithm first
computes an empirical
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value
for each SNP using a modest number of permutations which gives precise
enough estimates of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
above a threshold. Then, the SNPs with first stage
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values
being less than the threshold are moved to the second stage for a far
greater number of permutations.</p>
</div>
<div class="section level3">
<h3 id="recycle-permutation-result">Recycle permutation result<a class="anchor" aria-label="anchor" href="#recycle-permutation-result"></a>
</h3>
<p>Another key technique in <code>bd.test.gwas</code> is reusing the
empirical KBD‚Äôs distribution under the null hypothesis. This technique
is particularly helpful for decreasing computational burden when the
number of factors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is very large and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is a single digit. A typical case is the GWAS study, in which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>‚âà</mo><msup><mn>10</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">p \approx 10^4</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>5</mn></msup><annotation encoding="application/x-tex">10^5</annotation></semantics></math>
but
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">K = 3</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="power-evaluation">Power evaluation<a class="anchor" aria-label="anchor" href="#power-evaluation"></a>
</h2>
<p>According to the simulations:</p>
<ul>
<li><p>the empirical type I errors of KBD are reasonably controlled
around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mo>‚àí</mo><mn>5</mn></mrow></msup><annotation encoding="application/x-tex">10^{-5}</annotation></semantics></math>;</p></li>
<li><p>the power of KBD increases as either the sample size or the
difference between means or covariance matrices increases. The empirical
power is close to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
when the difference between distributions is large enough.</p></li>
</ul>
<p>Furthermore, correlated responses may slightly decrease the power of
the test compared to the case of independent responses. Moreover, KBD
performs better when the data are not extremely imbalanced and it
maintains reasonable power for the imbalanced setting.</p>
<p>Compared to other methods, KBD performs better in most of the
scenarios, especially when the simulation setting is close to the real
data. Moreover, KBD is more computationally efficient in identifying
significant variants.</p>
<p>From Figures 1 and 3, we can notice that the power curves are similar
after sample size of 500, when the minor allele frequency is not small.
On the other hand, when the minor allele is rare, a larger sample size
can lead to a higher power from Figures 2 and 4. The four figures show
how sample size could affect the power of the KBD method, indicating
that there is an inverse relationship between minor allele frequency and
the sample sizes in order to get sufficient power.</p>
<!-- ![](./kbd_gwas.png) -->
<p align="center">
<img src="kbd_gwas.png" width="500" height="500"></p>
<!-- ### Summary plots of simulation results of heterogeneous settings of the KBD method             -->
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>We implement <code>bd.test.gwas</code> in Ball package for handling
multiple KBD test. KBD is a powerful method that can detect the
significant variants with a controllable type I error regardless if the
data are balanced or not.</p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<p>Yue Hu, Haizhu Tan, Cai Li, Heping Zhang. (2021). Identifying genetic
risk variants associated with brain volumetric phenotypes via K-sample
Ball Divergence method. Genetic Epidemiology, 1‚Äì11. <a href="https://doi.org/10.1002/gepi.22423" class="external-link uri">https://doi.org/10.1002/gepi.22423</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jin Zhu, Wenliang Pan, Junhao Zhu, Yuan Tian, Weinan Xiao, Chengfeng Liu, Ruihuang Liu, Yue Hu, Hongtu Zhu, Heping Zhang, Xueqin Wang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
