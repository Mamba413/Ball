#include <stdlib.h>
#include <stdio.h>
#include "BI.h"
#include "BD.h"

void test_value(double *computed_value, double true_value)
{
	const double EPSINON = 0.0000001;
	double difference = (*computed_value) - true_value;
	if ((difference < EPSINON) & (difference > -EPSINON)) {
		printf("Success!\n\n");
	}
	else {
		printf("Fail!\n\n");
	}
	return;
}


double pvalue(double ball_stat_value, double *permuted_ball, int R)
{
	double larger_num = 0.0;
	for (int i = 0; i < R; i++)
	{
		if (permuted_ball[i] < ball_stat_value)
		{
			larger_num += 1.0;
		}
	}
	double p_value = 1.0 / (1.0 + larger_num);
	return(p_value);
}

void test_multithread_permutation()
{
	double ball_stat_value = 0.0;
	double permuted_ball[100];
	double x[10] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
	int size[2] = { 5, 5 };
	int n = 10, k = 2, dst = 0, R = 100, weight = 0, nth = 4;
	int parallel_type = 2;
	bd_test(&ball_stat_value, permuted_ball, x, size, &n, &k, &dst, &R, &weight, &nth, &parallel_type);
	double p_value = 0.0;
	p_value = pvalue(ball_stat_value, permuted_ball, R);
	printf("Ball statistics: %f; ", ball_stat_value);
	printf("p-value: %f \n", p_value);
	return;
}


void main()
{
	double tmp = 0.0;
	double *bcov_stat_value = &tmp, *bd_stat_value = &tmp;
	double x[10] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
	double y[10] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
	double z[15] = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 };
	int n = 10, weight = 0, dst = 0, type = 1, K = 2;
	int size[2] = { 5, 5 };
	int nth = 1;
	printf("----------- Test Computation for ball divergence (Two sample, Univariate) -----------\n");
	bd_stat(bd_stat_value, x, size, &n, &K, &weight, &dst, &nth);
	printf("Computation result: %f; ", *bd_stat_value);
	printf("True value: %f\nTest result: ", 0.7232);
	test_value(bd_stat_value, 0.7232);
	printf("----------- Test Computation for ball divergence (Two sample, Multivariate) -----------\n");
	double x_dst[100] = { 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 11.31371, 12.72792, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 11.31371, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 11.31371, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 12.72792, 11.31371, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0 };
	dst = 1;
	bd_stat(bd_stat_value, x_dst, size, &n, &K, &weight, &dst, &nth);
	printf("Computation result: %f; ", *bd_stat_value);
	printf("True value: %f\nTest result: ", 0.7232);
	test_value(bd_stat_value, 0.7232);
	printf("----------- Test Computation for ball divergence (K sample) -----------\n");
	int size1[3] = { 5, 5, 5 }; 
	int n1 = 15;
	K = 3;
	dst = 0;
	bd_stat(bd_stat_value, z, size1, &n1, &K, &weight, &dst, &nth);
	printf("Computation result: %f; ", *bd_stat_value);
	printf("True value: %f\nTest result: ", 2.4032);
	test_value(bd_stat_value, 2.4032);
	printf("----------- Test Computation for ball covariance (Univariate) -----------\n");
	bcov_stat(bcov_stat_value, x, y, &n, &weight, &dst, &type);
	printf("Computation result: %f; ", *bcov_stat_value);
	printf("True value: %f\nTest result: ", 0.034214);
	test_value(bcov_stat_value, 0.034214);
	printf("----------- Test Computation for ball covariance (Multivariate) -----------\n");
	double y_dst[100] = { 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 11.31371, 12.72792, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 11.31371, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 9.89949, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 8.48528, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 7.07107, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 5.65685, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 4.24264, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 2.82843, 11.31371, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0, 1.41421, 12.72792, 11.31371, 9.89949, 8.48528, 7.07107, 5.65685, 4.24264, 2.82843, 1.41421, 0 };
	dst = 1;
	bcov_stat(bcov_stat_value, x_dst, y_dst, &n, &weight, &dst, &type);
	printf("Computation result: %f; ", *bcov_stat_value);
	printf("True value: %f\nTest result: ", 0.034214);
	test_value(bcov_stat_value, 0.034214);
	printf("----------- Test Computation for ball correlation -----------\n");
	dst = 0;
	type = 2;
	bcov_stat(bcov_stat_value, x, y, &n, &weight, &dst, &type);
	printf("Computation result: %f; ", *bcov_stat_value);
	printf("True value: %f\nTest result: ", 1.0000);
	test_value(bcov_stat_value, 1.0000);

	//printf("----------- Test Multi-thread -----------\n");
	//double permuted_bcov[10000];
	//double m1[500] = { 1.08837, -0.97366, -0.14463, -1.74737, -0.33314, -0.59724, -0.43556, 0.90097, -0.17926, -0.50293, -0.46313, 1.34861, 0.69907, -0.14161, -0.01974, -0.28245, -0.58671, -0.19274, -1.19092, -1.0305, 0.21805, 2.11794, -0.52646, 1.8246, 0.81556, -0.36491, 0.71661, -0.83224, 0.21435, 2.12217, 0.26824, 0.54749, -0.90835, 0.63278, -1.89402, -0.78611, 0.65132, 2.34997, -0.20414, -0.7907, 0.00118, 0.72869, -0.62324, -0.58815, 1.39272, -0.01284, -1.16032, -0.59133, -0.50471, -0.66761, 0.74484, -0.63312, 0.70599, 0.37722, -1.96205, 2.68086, -0.56146, -0.09524, -0.82673, 0.90261, 0.59155, -0.76322, -0.34845, -0.40582, 1.63254, 0.10744, 0.97182, -1.60693, 0.34145, -0.44532, 0.06644, -1.14121, 1.38032, 0.18508, 1.37783, 0.34288, 0.37413, 0.02954, 1.65979, -0.63205, 0.39136, 1.16937, 1.4187, 0.33232, 0.09469, 0.18154, -0.57579, 0.05015, -0.76944, -0.06505, 0.65398, 1.52831, -0.78746, 0.77654, 0.37783, 1.38389, -0.03591, -0.48486, 0.64004, -1.31675, 0.36724, -0.055, -0.98871, -1.05039, 1.02977, -0.12941, 0.90065, -0.31512, -0.39973, -0.5927, 2.21613, 3.27482, -1.06057, 1.1904, -0.20048, -1.78073, 0.10895, -0.34348, -1.06109, -0.03309, -0.64515, 0.40684, -0.11016, -0.98614, 1.16335, -1.11748, 0.45911, -0.48384, -1.78631, 2.05555, 0.80558, 0.22366, -0.12919, -0.40823, -1.70383, 0.10302, -0.07558, -0.49967, 0.15184, -0.09365, -0.6384, -0.10343, -1.31835, -0.43143, -1.0503, -0.53429, 1.24063, 1.68421, 1.19785, -1.03705, 0.97933, -0.08066, -1.40248, 0.47796, -0.14243, 0.57394, 0.41081, 0.33121, -1.19774, -1.51809, -0.11089, -1.6925, 0.8778, -0.26082, 1.74338, -1.12757, 1.06057, -0.29711, 1.06931, 1.60571, -1.08619, -0.51822, 0.75872, -0.57019, -0.21889, -0.51164, 2.18044, 1.12248, 0.43728, 0.15939, -1.22468, 0.97876, -0.93903, -0.58198, -0.06572, -1.39376, -2.57313, -0.31769, -0.92293, -0.3034, -0.26359, -0.05068, 0.59819, -0.5007, -0.79025, -0.31031, 0.01873, -1.03714, -1.43518, 0.44748, 1.31825, -2.54427, 0.29688, 0.69988, 2.45557, 1.46687, -0.17652, -0.1661, 1.12561, -0.99097, 1.74534, -0.34647, 0.31116, 0.51422, -0.01489, 0.60155, 2.30481, -0.12264, -0.97583, -0.50407, -1.98115, 0.30902, 0.73245, 1.99584, 2.04332, -0.61705, 0.04842, 1.36524, 1.18251, 2.94207, -1.9307, 0.79862, 1.63472, 0.82461, -1.99281, -0.37531, -0.0894, -0.20632, -0.65629, -0.55689, 0.26395, 0.96604, -0.2776, -0.03345, 0.69473, 0.10187, 0.5109, -0.87169, -1.93284, -2.01018, -1.91614, 1.24273, 1.58289, -0.43579, -0.3023, -0.26309, -1.37543, -0.71144, -1.10916, -1.28979, -1.39923, 1.58925, -1.37161, -0.53388, 0.34251, -1.50549, 1.55516, -0.25351, 1.76456, 1.49681, 0.27167, -0.06571, -0.73207, -1.465, 1.68213, -0.7596, 0.65023, -0.46029, 0.07222, -0.59627, 1.00329, 0.8737, 1.03012, -0.67591, 0.24637, 0.01737, 0.28878, -0.41112, 0.73276, -0.26209, -1.80494, -0.47782, 0.19314, 0.38121, -0.52558, -1.13714, -0.31697, 1.46324, 0.8065, -0.57543, -0.33364, -1.3644, 1.18588, 0.83886, 1.00207, 0.33923, -2.64925, -0.53554, 1.09432, 0.1108, -0.22685, -0.19691, -0.0756, 0.11181, -0.67366, -0.12541, 0.67958, 1.51639, 1.08561, -0.47248, -0.25048, 0.13187, 1.92332, -0.24112, 0.16005, -0.31166, -0.27018, 0.83693, 1.16999, -1.07348, 0.65459, 1.06001, -0.78706, -0.09592, -1.48394, -0.29017, 0.37091, -1.67488, 0.62966, -0.18485, -0.19833, -0.80221, -0.05065, -1.4575, 0.74765, -0.71136, 1.0386, 0.4415, -1.39913, 2.78556, 0.49137, 0.40963, 0.35413, 0.19823, -1.34214, -0.03025, 1.78693, -0.74889, 0.78155, 0.7801, -1.06375, -0.1348, -0.5655, -1.57548, 0.94146, -0.72029, -1.57808, 0.13325, 1.49418, -0.41514, -1.39872, 1.6656, -0.36637, 1.68952, -0.5361, 1.42374, -0.12491, -0.07955, -1.24456, -0.41542, -0.45017, -0.26945, 2.18117, -1.77597, 0.43219, 0.37185, 0.23178, -0.36794, -1.08646, 0.72553, -0.06628, 0.1867, -0.35604, 1.70114, 0.18321, -0.2381, -0.41968, 0.61621, 0.07051, 0.36651, -2.19726, -0.00682, 1.60931, 1.40876, 0.8708, 1.38364, 0.07981, 0.65166, -0.87882, 0.00109, -0.57891, 0.75607, 0.03181, 0.70086, -1.07109, 1.50089, 1.09098, 0.77801, 0.74075, 1.04036, 0.24449, 0.59291, 0.53829, -2.19931, 1.53816, 0.48325, -0.18343, -0.0382, -0.82952, 0.36279, 2.36051, 0.10282, -0.23883, 0.70969, 1.68131, -0.74803, 0.91505, 1.37091, 0.04017, -0.47114, -1.12378, -2.13866, -0.114, -0.34239, -0.19135, 0.24358, -0.69458, 1.33927, 1.47471, -0.0444, -0.12923, -0.5318, 1.99953, 0.47496, 0.64181, -1.09011, 1.33332, -0.0255, 1.73117, -0.02157, 0.7817, 1.68187, -0.62497, 0.40832, 0.24626, 1.02874, -0.05426, -0.78812, -1.36266, 2.07591, 1.17601, -0.05496, 1.14451, 0.0735, 0.27128, 0.48998, 1.30076, 2.10199, 0.26988, -0.09657, -0.89352, 1.34594, 0.29536, -0.35202, -0.02665, 1.40445, 0.10872, -1.46292, 1.18304, 1.12494, -0.2134, 0.5972, -0.42949, 2.31906, -0.05024, -1.23675, -0.11681, -0.22015, 0.70427, 0.30114 };
	//double m2[500] = { 0.59043, 0.73902, 1.35969, 0.4717, -0.55702, 0.28087, -0.79588, 0.39794, 1.57425, 0.61559, 0.77355, -1.85854, -0.17649, 1.06796, -0.87918, -1.25702, -0.32604, -0.23308, -0.35538, 0.48762, 0.21494, 0.69872, 2.54709, -1.02198, -0.86901, 0.92635, 0.11074, 0.03724, -0.40435, 0.40193, 0.29703, 1.18189, -1.41418, 0.10286, -0.3811, 0.47089, 0.30077, -0.03538, 0.03005, -1.10409, 1.13098, 0.24908, -0.9922, -2.40896, -0.04575, 0.06339, 1.00315, -0.74341, 0.26145, 0.32623, 0.62598, 0.29423, 0.68507, 1.10518, 0.70028, -0.5827, 0.02686, -0.96166, 0.22425, 0.54776, -1.57828, 1.90769, -0.03892, 0.10218, -1.34784, 0.76384, -1.03568, -0.01839, 0.78073, -0.18943, 0.02429, 0.66767, -0.55091, -0.48733, 0.57697, -0.52754, 1.20016, 1.03704, -1.2767, -2.78332, -0.09774, 1.37233, -0.28072, 1.24304, -0.44657, -0.60707, 0.80708, -0.95652, -0.73488, -0.1663, 0.29311, 0.42848, 0.88589, 0.18805, -2.01079, -1.25916, 1.03503, -1.08605, 0.04879, -0.18096, -0.11604, -0.19174, 1.34531, -1.46607, 0.55778, -0.24264, 1.11762, -0.84022, -0.18617, -1.66689, -2.44636, 0.21207, -1.45472, 1.06371, 0.05923, 0.49381, 1.35934, -0.19161, -2.02131, 0.03412, 1.19291, -0.73306, 0.76295, -1.07641, 0.85412, 1.16764, 0.99569, 0.14673, 0.91969, 1.32688, -0.08978, -0.95189, -0.346, 0.71143, 0.00157, 1.86995, 1.1947, -0.16909, 0.52508, 0.31753, -0.78823, 0.64893, -0.66965, -0.29468, -0.38501, 1.27336, 0.72214, 0.38427, 1.60488, -0.79293, -0.91361, -0.25728, 0.3311, -1.24378, 0.82229, 0.62758, -2.27309, 0.77812, -0.46307, 0.48409, -0.19249, -0.49241, 0.40484, 0.52682, 0.11376, -1.96371, 0.65966, 1.31904, 0.46204, 1.51428, 0.22505, 0.55186, 1.54479, -0.32964, 0.00956, -0.37837, -0.12939, 1.28034, -0.93739, 0.3324, -0.65837, -0.89723, 0.46224, 0.2937, -0.04323, -0.12029, 0.80673, -1.84476, 0.15184, -1.31891, 0.82292, 0.96672, 0.35302, -0.05274, -0.48815, -0.86286, -1.86579, 0.75751, 0.32389, 0.36092, 0.46473, 0.25634, 0.45608, -2.00679, 0.6134, -1.06691, 0.20428, 0.33744, -1.10731, 0.83024, -0.72591, -0.2822, -0.6684, 0.2243, -1.92791, -0.77893, -1.60536, -0.92753, -1.10094, -0.85466, 0.48333, -0.57182, 0.75615, -0.06397, -1.48506, 1.6857, 1.20692, -1.43756, 0.0759, -0.12987, -0.80226, -1.68567, -0.23085, 0.12065, 1.62835, 0.52099, 0.92947, -1.69064, 0.7264, -1.55475, 0.27229, 0.02162, -0.38901, -0.40211, 0.04171, 0.30869, 1.81743, -0.84171, -0.34589, 1.67376, 0.14069, 0.65859, -0.27017, -0.22909, -0.03824, 0.36274, -0.83248, -1.93866, -0.06766, -0.96975, 1.49781, 0.85687, -0.51741, -1.2366, -0.50588, -0.23323, 0.06055, -0.28679, 0.42638, 0.41716, -0.85856, 1.24501, -0.54944, -2.14373, -0.70306, -1.29784, 0.30303, -1.12085, -0.9563, -0.44079, -1.62482, 1.1295, 1.0375, -0.76894, -1.02874, -0.04127, -0.20329, 2.16398, 1.26837, -1.67849, -0.77004, -0.43606, -0.04388, 0.15593, -0.22608, 0.69059, -0.36136, 0.38308, -0.1214, -0.33405, 0.97822, 0.37216, 0.7743, -0.2597, 0.17904, 0.86038, 0.08493, -1.84777, -0.62562, -0.89226, -0.17838, 0.66459, -0.31715, 0.19586, 1.37068, -0.16929, -0.49169, -0.26572, -0.39948, -1.50093, -1.50519, -1.6248, -0.59873, -0.74251, -0.9206, -0.67699, 0.93957, -1.00901, 0.27976, -0.30027, 0.91222, 0.13222, 0.09407, -0.00448, 0.87424, 0.52401, -0.20452, 1.38131, 0.75715, 0.62505, -0.31664, -1.08908, 0.67025, 0.32057, 0.67536, 0.20215, 2.48281, -0.14602, -1.46856, -0.11344, -0.73773, -1.46799, 0.35057, 0.72066, 0.80357, 0.02462, -0.61924, -0.50905, 0.58542, -0.97892, -0.42476, -0.14205, -0.87877, -0.3683, 0.67675, 1.83454, 0.52829, 0.27148, 1.36463, -0.78017, -0.48732, 0.60565, -0.97053, 0.28047, -0.44951, -0.72792, 0.69981, -0.28562, -0.74792, 0.15289, 0.9952, 0.41952, 0.48554, -2.19451, 0.01642, 0.57162, 2.07191, 2.44355, -0.14499, -1.40803, -0.69705, -0.02143, -0.06746, 1.63641, -0.69513, 0.95718, 0.05925, 0.05848, 0.02399, 2.07293, -0.04626, -0.34551, 1.1117, -2.62044, -0.26545, 1.62817, -0.03607, 0.20276, -0.53158, 1.44436, -0.86126, -1.38459, 0.56972, 0.22826, -1.19282, -1.88144, -0.06037, -0.86134, 0.12943, -0.33455, -1.27462, 1.00022, -1.01642, -2.14409, -0.20117, 1.82033, 0.14003, -0.11077, 0.69637, -0.64455, -0.60274, -0.00191, 0.78019, 0.45039, -0.11985, -0.24543, 1.24644, -1.09524, 0.28411, -0.14997, -0.46216, 0.6948, -0.88775, 0.39214, 0.42642, -1.65611, -1.42844, 0.43892, -1.34412, 0.79907, 1.15016, 1.39097, -0.23473, -1.02691, 0.39496, -0.85243, 0.8836, 0.34019, 0.63432, 0.48672, -0.04512, 0.57848, 0.70554, 0.45539, -0.24069, 1.02068, 0.78303, -0.83741, 0.42064, 0.06586, -0.95693, -0.14122, -0.50722, -2.47783, -0.48123, 0.5985, 0.71655, -0.40602, -0.26169, -0.99237, 1.21474, -0.19264, 0.46304, 0.85428, 0.10044, -0.8947, -0.95167, -0.99662, 0.90768, -0.00923, 0.55399, 0.3596, 0.19553, 0.02627, 0.75873, -0.16044, 1.13287, -0.55721, -0.6246, 1.30546 };
	//n = 500;
	//int R = 10000;
	//type = 1;
	//dst = 0;
	//bcov_test(bd_stat_value, permuted_bcov, m1, m2, &n, &R, &weight, &dst, &type);

	test_multithread_permutation();
	system("pause");
	return;
}

